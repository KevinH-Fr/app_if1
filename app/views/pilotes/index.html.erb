
<% if user_signed_in? %>

  <br/>
  <h1 class="fa-solid fa-user fa-2xl fw-bold fs-1"> - Pilotes </h1>   
  <br/>  <hr/>

        <%# zone recherce pilote %>
        <form action="/pilotes" method="GET">
          <input type="text" name="search_name" >
          <input type="submit" value="Chercher" class="btn btn-primary">
        </form>

        <%# filtres sur datas %>
        <form action="/pilotes" method="GET">
        <%#<label for="filter">Filtres : </label> %>
        <%# if session[:filter] == "team" %>
          <select name="filter_option" onchange="this.form.submit()">
            <option value="">Choisir une division</option>
              <% @divisions.each do |division| %>
                <option value="<%= division.id %>"><%= division.nom %></option>
              <% end %>
          </select>
        <%# end %>
      </form>
      <%#= link_to "Effacer filtrer", clear_path, class:"btn btn-outline-danger" %> 

      <%= link_to "testClearSession", clear_session_path  %>

 <%#= link_to 'Click here to delete your widget session!', widget_session_path(), method: :delete %>

  <br/> <hr/> <br/>

  <%# tableau datas %>

   <%# resultats du filtre %>

  <table class="table table-striped table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>Pilote</th>
        <th>Division</th>
        <th>Statut</th>
        <th colspan="3">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @divisions.each do |division| %>
       <%#   <%= division.nom %>
        <tbody>
          <% @pilotes.where(division_id: division.id).each do |pilote| %>
            <tr>

              <td>  
                <% if pilote.ecurie.blank?%>
                    <%= image_tag 'no-image.png', alt: 'icon', width: '200' %>
                  <% else %>
                    <%= link_to(pilote) do %>
                        <div class="contenant">
                          <%= image_tag(Equipe.find(pilote.ecurie).logo, style: "width: 400px; display: block", class: "img-fluid rounded") %> 
                            <div class="texte_centrer"><%=  "#{pilote.nom}" %></div>
                        </div>
                    <% end %>
                  <% end %>
              </td>

              <td>
               <% divisionLiee = "#{pilote.division_id}" %>
               <% numDivision = Division.find(divisionLiee).numero %>

               <% if numDivision == 1 %>
                    <ul class="darkred">
                      <%= Division.find(divisionLiee).nom %>
                <% else %>
                   <% if numDivision == 2 %>
                    <ul class="blue">
                      <%= Division.find(divisionLiee).nom %>
                    <% end %>
                <% end %>
              </td>

              <td> 
                <% if "#{pilote.statut}" == "actif" %>
                      <ul class="green">
                      <%= "#{pilote.statut}" %>
                  <% else %>
                      <ul class="red">
                        <%= "#{pilote.statut}" %>
                  <% end %> 
              </td>

              <td width="5%">
                <%= link_to '', pilote, class:"fa-solid fa-eye btn btn-primary" %> 
              </td>
              <td width="5%">
                <%= button_to '', pilote, class:"fa-solid fa-trash-can btn btn-danger", method: :delete, :onclick => "return confirm('SÃ»r ?')" %>
              </td> 
              <td width="5%">
                <%= link_to "", edit_pilote_path(pilote), class:"fa-regular fa-pen-to-square btn btn-secondary" %> 
              </td> 


            </tr>
          <% end %>
      <% end %>
    </tbody>
  </table>

  <br/>

  <%= link_to "Nouveau pilote", new_pilote_path, class:"btn btn-primary" %>

  <br/> <hr/> <br/>

  <%= link_to "Editer", "editions/grille", :div => params[:id], class:"btn btn-warning" %>

  <%#= link_to "Nouvelle commande bis", new_commande_path(:client => params[:id]) %>





<% else %>

  <h3> Vous n'avez pas les droits...</h3>
  
<% end %>


